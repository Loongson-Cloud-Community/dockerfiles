(window.webpackJsonp=window.webpackJsonp||[]).push([["jD3k"],{jD3k:function(t,e,s){"use strict";s.r(e);var i=s("gDS+"),n=s.n(i),a=s("P2sY"),l=s.n(a),r=s("ZR4k"),o=s.n(r),c=s("EHAl"),p=s("F2Sz"),u=s("+n5z"),m=s("Yfch"),h=s("Mz3J"),d=s("t3Un"),f="/admin/v3";var g=s("1tBZ"),k={tenant:"",namespace:""},b={name:"Sinks",components:{jsonEditor:u.a,Pagination:h.a},data:function(){return{codeValue:null,postForm:l()({},k),tenantsListOptions:[],namespacesListOptions:[],inputTopicsListOptions:[],guanrateesListOptions:[],instancesListOptions:[],localList:[],searchList:[],tenant:"",namespace:"",jsonValue:{},tableKey:0,total:0,listLoading:!1,dialogFormVisible:!1,list:null,currentFile:"",triggerFile:"",currentTriggerFileName:"",currentSink:"",dialogStatus:"",listQuery:{topic:"",page:1,limit:10},temp:{sink:"",instanceId:0,className:"",cpu:"",disk:"",ram:"",schemaInput:"",parallelism:"",schemaType:"",currentFile:"",currentFileName:"",currentConfigFile:"",currentConfigFileName:"",sinkConfig:"",triggerValue:"",triggerInput:"",deClassName:"",guarantees:""},rules:{sink:[{required:!0,message:"sink name is required",trigger:"blur"}],className:[{required:!0,message:"className is required",trigger:"blur"}],inputTopic:[{required:!0,message:"inputTopic is required",trigger:"blur"}]}}},mounted:function(){this.guanrateesListOptions=["ATLEAST_ONCE","ATMOST_ONCE","EFFECTIVELY_ONCE"]},created:function(){this.getSinks(),this.getRemoteTenantsList()},methods:{getSinks:function(){var t=this;this.localList.length>0?setTimeout(function(){t.localPaging()},0):(this.listLoading=!0,this.postForm.tenant.length>0&&(this.tenant=this.postForm.tenant),this.postForm.namespace.length>0&&(this.namespace=this.postForm.namespace),(this.tenant.length<=0||this.namespace.length<=0)&&(this.tenant="public",this.namespace="default"),function(t,e){return Object(d.a)({url:f+"/sink/"+t+"/"+e,method:"get"})}(this.tenant,this.namespace).then(function(e){for(var s=0;s<e.data.length;s++)t.localList.push({sink:e.data[s],stats:"stats",status:"status"});t.total=t.localList.length,t.list=t.localList.slice((t.listQuery.page-1)*t.listQuery.limit,t.listQuery.limit*t.listQuery.page),setTimeout(function(){t.listLoading=!1},1500)}))},localPaging:function(){if(this.listLoading=!0,Object(m.a)(this.listQuery.topic))this.total=this.localList.length,this.list=this.localList.slice((this.listQuery.page-1)*this.listQuery.limit,this.listQuery.limit*this.listQuery.page);else{this.searchList=[];for(var t=0;t<this.localList.length;t++)-1!==this.localList[t].sink.indexOf(this.listQuery.topic)&&this.searchList.push(this.localList[t]);this.total=this.searchList.length,this.list=this.searchList.slice((this.listQuery.page-1)*this.listQuery.limit,this.listQuery.limit*this.listQuery.page)}this.listLoading=!1},handleFilter:function(t,e){this.tenant=t,this.namespace=e,this.getSinks()},handleCreate:function(){var t=this;this.dialogStatus="create",this.dialogFormVisible=!0,this.resetTemp(),this.$nextTick(function(){t.$refs.temp.clearValidate()})},getCurrentRow:function(t){this.currentSink=t.sink},handleDelete:function(){var t=this;this.currentSink.length<=0?this.$notify({title:"error",message:"Please select any one sink in table",type:"error",duration:3e3}):function(t,e,s){return Object(d.a)({url:f+"/sink/"+t+"/"+e+"/"+s,method:"delete"})}(this.tenant,this.namespace,this.currentSink).then(function(e){t.$notify({title:"success",message:"delete sink sink",type:"success",duration:2e3}),t.localList=[],t.getSinks()})},confirmCreateSink:function(){var t=this;this.$refs.temp.validate(function(e){if(e){var s=t.prepareSinkParams(t.temp.sink);(function(t,e,s,i){return Object(d.a)({headers:{"Content-Type":"multipart/form-data"},url:f+"/sink/"+t+"/"+e+"/"+s,method:"post",data:i})})(t.tenant,t.namespace,t.temp.sink,s).then(function(e){t.$notify({title:"success",message:"create sink success",type:"success",duration:2e3}),t.dialogFormVisible=!1,t.localList=[],t.getSinks()})}})},handleUpdate:function(){this.resetTemp(),this.currentSink.length<=0?this.$notify({title:"error",message:"Please select any one sink in table",type:"error",duration:3e3}):(this.dialogStatus="update",this.dialogFormVisible=!0)},handleAction:function(t,e){var s=this;this.dialogStatus=t,this.dialogFormVisible=!0,this.instancesListOptions=[],this.currentSink=e.sink,function(t,e,s){return Object(d.a)({url:f+"/sink/"+t+"/"+e+"/"+s+"/status",method:"get"})}(this.tenant,this.namespace,e.sink).then(function(t){for(var e=0;e<t.data.instances.length;e++)s.instancesListOptions.push(t.data.instances[e].instanceId)})},handleOptions:function(){switch(this.dialogStatus){case"create":this.confirmCreateSink();break;case"start":this.confirmStart();break;case"stop":this.confirmStop();break;case"restart":this.confirmRestart();break;case"update":this.confirmUpdate();break;case"status":this.confirmStatus()}},loadTextFromFile:function(t){var e=this,s=t.target.files[0];console.log(t.target),console.log(t.target.files),this.temp.currentFileName=s.name;var i=new FileReader;i.onload=function(t){e.temp.currentFile=t.target.result},i.readAsArrayBuffer(s)},loadSinkConfigFile:function(t){var e=this,s=t.target.files[0];this.temp.currentConfigFileName=s.name;var i=new FileReader;i.onload=function(t){e.temp.currentConfigFile=t.target.result},i.readAsText(s)},handleGet:function(t){var e=this;(function(t,e,s){return Object(d.a)({url:f+"/sink/"+t+"/"+e+"/"+s,method:"get"})})(this.tenant,this.namespace,t.sink).then(function(t){e.jsonValue=t.data})},confirmStart:function(){var t=this;(function(t,e,s,i){return Object(d.a)({url:f+"/sink/"+t+"/"+e+"/"+s+"/"+i+"/start",method:"post"})})(this.tenant,this.namespace,this.currentSink,this.temp.instanceId).then(function(e){t.$notify({title:"success",message:"start sink success",type:"success",duration:2e3}),t.dialogFormVisible=!1})},confirmStop:function(){var t=this;(function(t,e,s,i){return Object(d.a)({url:f+"/sink/"+t+"/"+e+"/"+s+"/"+i+"/stop",method:"post"})})(this.tenant,this.namespace,this.currentSink,this.temp.instanceId).then(function(e){t.$notify({title:"success",message:"stop sink success",type:"success",duration:2e3}),t.dialogFormVisible=!1})},confirmRestart:function(){var t=this;(function(t,e,s,i){return Object(d.a)({url:f+"/sink/"+t+"/"+e+"/"+s+"/"+i+"/restart",method:"post"})})(this.tenant,this.namespace,this.currentSink,this.temp.instanceId).then(function(e){t.$notify({title:"success",message:"restart sink success",type:"success",duration:2e3}),t.dialogFormVisible=!1})},confirmStatus:function(){var t=this;(function(t,e,s,i){return Object(d.a)({url:f+"/sink/"+t+"/"+e+"/"+s+"/"+i+"/status",method:"get"})})(this.tenant,this.namespace,this.currentSink,this.temp.instanceId).then(function(e){t.jsonValue=e.data,t.$notify({title:"success",message:"get status sink success",type:"success",duration:2e3}),t.dialogFormVisible=!1})},prepareSinkParams:function(t){var e=new FormData,s={topicName:t,className:this.temp.className,tenant:this.tenant,namespace:this.namespace};t.length>0&&(s.name=t);var i=new Blob([this.temp.currentFile],{type:"application/octet-stream"});if(s.archive=this.temp.currentFileName,s.inputs=[this.temp.inputTopic],e.append("data",i,this.temp.currentFileName),this.temp.schemaType.length>0&&(s.schemaType=this.temp.schemaType),this.temp.cpu.length>0&&(s.resources={cpu:parseInt(this.temp.cpu)}),this.temp.disk.length>0&&(s.resources={disk:this.temp.disk}),this.temp.ram.length>0&&(s.resources={ram:this.temp.ram}),this.temp.parallelism.length>0&&(s.parallelism=parseInt(this.temp.parallelism)),this.temp.guarantees.length>0&&(s.processingGuarantees=this.temp.guarantees),this.temp.sinkConfig.length>0&&(s.configs=JSON.parse(this.temp.sinkConfig)),this.temp.currentConfigFile.length>0){var a=o.a.load(this.temp.currentConfigFile),l=JSON.parse(n()(a));s.configs=l.configs}return e.append("sinkConfig",n()(s)),e},confirmUpdate:function(){var t=this;this.$refs.temp.validate(function(e){if(e){var s=t.prepareSinkParams("");(function(t,e,s,i){return Object(d.a)({headers:{"Content-Type":"multipart/form-data"},url:f+"/sink/"+t+"/"+e+"/"+s,method:"put",data:i})})(t.tenant,t.namespace,t.currentSink,s).then(function(e){t.$notify({title:"success",message:"update sink success",type:"success",duration:2e3}),t.dialogFormVisible=!1})}})},getSinksList:function(){this.getSinks()},builtinSinks:function(){var t=this;Object(d.a)({url:f+"/sink/builtinsinks",method:"get"}).then(function(e){t.jsonValue=e.data})},getRemoteTenantsList:function(){var t=this;Object(c.b)().then(function(e){e.data&&(t.tenantsListOptions=e.data)})},getNamespacesList:function(t){var e=this;this.tenant=t,Object(p.f)(t,this.query).then(function(t){for(var s=[],i=0;i<t.data.length;i++)s=t.data[i].split("/"),e.namespacesListOptions.push(s.splice(1,s.length).join("/"))})},getTopicsList:function(){var t=this;this.inputTopicsListOptions=[],Object(g.j)(this.tenant,this.namespace).then(function(e){for(var s=0;s<e.data.length;s++)t.inputTopicsListOptions.push(e.data[s])}),Object(g.h)(this.tenant,this.namespace).then(function(e){for(var s=0;s<e.data.length;s++)t.inputTopicsListOptions.push(e.data[s])}),Object(g.m)(this.tenant,this.namespace,this.listQuery).then(function(e){for(var s=0;s<e.data.length;s++)t.inputTopicsListOptions.push(e.data[s])})},resetTemp:function(){this.temp={sink:"",instanceId:0,className:"",cpu:"",disk:"",ram:"",schemaInput:"",parallelism:"",schemaType:"",currentFile:"",currentFileName:"",currentConfigFile:"",currentConfigFileName:"",sinkConfig:"",triggerValue:"",triggerInput:"",deClassName:"",guarantees:""}}}},v=s("KHd+"),y=Object(v.a)(b,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"createPost-container"},[s("el-form",{ref:"postForm",staticClass:"form-container",attrs:{model:t.postForm}},[s("div",{staticClass:"createPost-main-container"},[s("el-row",[s("el-col",{attrs:{span:12}},[s("div",{staticClass:"postInfo-container"},[s("el-row",[s("el-col",{attrs:{span:8}},[s("el-form-item",{staticClass:"postInfo-container-item"},[s("el-select",{attrs:{placeholder:"select tenant"},on:{change:function(e){return t.getNamespacesList(t.postForm.tenant)}},model:{value:t.postForm.tenant,callback:function(e){t.$set(t.postForm,"tenant",e)},expression:"postForm.tenant"}},t._l(t.tenantsListOptions,function(t,e){return s("el-option",{key:t+e,attrs:{label:t,value:t}})}),1)],1)],1),t._v(" "),s("el-col",{attrs:{span:8}},[s("el-form-item",{staticClass:"postInfo-container-item"},[s("el-select",{attrs:{placeholder:"select namespace"},on:{change:function(e){return t.getSinksList(t.postForm.tenant,t.postForm.namespace)}},model:{value:t.postForm.namespace,callback:function(e){t.$set(t.postForm,"namespace",e)},expression:"postForm.namespace"}},t._l(t.namespacesListOptions,function(t,e){return s("el-option",{key:t+e,attrs:{label:t,value:t}})}),1)],1)],1)],1)],1)])],1)],1)])],1),t._v(" "),s("div",[s("div",{staticClass:"filter-container"},[s("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:t.$t("table.sinks")},nativeOn:{keyup:function(e){return"keyCode"in e&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.listQuery.topic,callback:function(e){t.$set(t.listQuery,"topic",e)},expression:"listQuery.topic"}}),t._v(" "),s("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v(t._s(t.$t("table.search")))]),t._v(" "),s("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.handleCreate}},[t._v(t._s(t.$t("table.add")))]),t._v(" "),s("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.handleUpdate}},[t._v(t._s(t.$t("table.edit")))]),t._v(" "),s("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.handleDelete}},[t._v(t._s(t.$t("table.delete")))]),t._v(" "),s("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.builtinSinks}},[t._v(t._s(t.$t("table.builtin")))])],1),t._v(" "),s("el-row",{attrs:{gutter:8}},[s("el-col",{staticStyle:{"padding-right":"8px","margin-bottom":"30px"},attrs:{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:14},xl:{span:14}}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.list,border:"",fit:"","highlight-current-row":""},on:{"row-click":t.getCurrentRow}},[s("el-table-column",{attrs:{label:t.$t("table.sinks"),"min-width":"50px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.sink))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("table.stats"),"min-width":"40px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"link-type",on:{click:function(s){return t.handleGet(e.row)}}},[t._v(t._s(e.row.stats))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("table.status"),"min-width":"40px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"link-type",on:{click:function(s){return t.handleAction("status",e.row)}}},[t._v(t._s(e.row.status))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("table.actions"),align:"center",width:"250","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){return t.handleAction("start",e.row)}}},[t._v(t._s(t.$t("table.start")))]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){return t.handleAction("stop",e.row)}}},[t._v(t._s(t.$t("table.stop")))]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){return t.handleAction("restart",e.row)}}},[t._v(t._s(t.$t("table.restart")))])]}}])})],1),t._v(" "),s("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.page,limit:t.listQuery.limit},on:{"update:page":function(e){return t.$set(t.listQuery,"page",e)},"update:limit":function(e){return t.$set(t.listQuery,"limit",e)},pagination:t.getSinks}})],1),t._v(" "),s("el-col",{staticStyle:{"margin-bottom":"30px"},attrs:{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:10},xl:{span:10}}},[s("jsonEditor",{attrs:{value:t.jsonValue}})],1)],1),t._v(" "),s("el-dialog",{attrs:{visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{ref:"temp",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"100px"}},["create"===t.dialogStatus||"update"===t.dialogStatus?s("div",["create"===t.dialogStatus?s("div",[s("el-form-item",{attrs:{label:"name",prop:"sink"}},[s("el-input",{model:{value:t.temp.sink,callback:function(e){t.$set(t.temp,"sink",e)},expression:"temp.sink"}})],1)],1):t._e(),t._v(" "),"update"===t.dialogStatus?s("div",[s("el-form-item",{attrs:{label:"name"}},[s("span",[t._v(t._s(t.currentSink))])])],1):t._e(),t._v(" "),s("el-form-item",{attrs:{label:"archive",prop:"file"}},[s("input",{attrs:{type:"file"},on:{change:t.loadTextFromFile}})]),t._v(" "),s("el-form-item",{attrs:{label:"class",prop:"className"}},[s("el-input",{model:{value:t.temp.className,callback:function(e){t.$set(t.temp,"className",e)},expression:"temp.className"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"configFile",prop:"sinkConfigFile"}},[s("input",{attrs:{type:"file"},on:{change:t.loadSinkConfigFile}})]),t._v(" "),s("el-form-item",{attrs:{label:"input",prop:"inputTopic"}},[s("el-select",{attrs:{placeholder:"select topic"},on:{focus:function(e){return t.getTopicsList()}},model:{value:t.temp.inputTopic,callback:function(e){t.$set(t.temp,"inputTopic",e)},expression:"temp.inputTopic"}},t._l(t.inputTopicsListOptions,function(t,e){return s("el-option",{key:t+e,attrs:{label:t,value:t}})}),1)],1),t._v(" "),s("el-form-item",{attrs:{label:"cpu",prop:"cpu"}},[s("el-input",{model:{value:t.temp.cpu,callback:function(e){t.$set(t.temp,"cpu",e)},expression:"temp.cpu"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"disk",prop:"disk"}},[s("el-input",{model:{value:t.temp.disk,callback:function(e){t.$set(t.temp,"disk",e)},expression:"temp.disk"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"ram",prop:"ram"}},[s("el-input",{model:{value:t.temp.ram,callback:function(e){t.$set(t.temp,"ram",e)},expression:"temp.ram"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"schema",prop:"schemaInput"}},[s("el-input",{model:{value:t.temp.schemaInput,callback:function(e){t.$set(t.temp,"schemaInput",e)},expression:"temp.schemaInput"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"deClassName",prop:"deClassName"}},[s("el-input",{model:{value:t.temp.deClassName,callback:function(e){t.$set(t.temp,"deClassName",e)},expression:"temp.deClassName"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"parallelism",prop:"parallelism"}},[s("el-input",{model:{value:t.temp.parallelism,callback:function(e){t.$set(t.temp,"parallelism",e)},expression:"temp.parallelism"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"schemaType",prop:"schemaType"}},[s("el-input",{model:{value:t.temp.schemaType,callback:function(e){t.$set(t.temp,"schemaType",e)},expression:"temp.schemaType"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"guarantees",prop:"guarantees"}},[s("el-select",{attrs:{placeholder:"select guarantees"},model:{value:t.temp.guarantees,callback:function(e){t.$set(t.temp,"guarantees",e)},expression:"temp.guarantees"}},t._l(t.guanrateesListOptions,function(t,e){return s("el-option",{key:t+e,attrs:{label:t,value:e}})}),1)],1),t._v(" "),s("el-form-item",{attrs:{label:"sinkConfig",prop:"sinkConfig"}},[s("el-input",{model:{value:t.temp.sinkConfig,callback:function(e){t.$set(t.temp,"sinkConfig",e)},expression:"temp.sinkConfig"}})],1)],1):t._e(),t._v(" "),"start"===t.dialogStatus||"stop"===t.dialogStatus||"restart"===t.dialogStatus||"status"===t.dialogStatus?s("div",[s("el-form-item",{attrs:{label:"instanceId",prop:"instanceId"}},[s("el-select",{attrs:{placeholder:"select instanceId"},model:{value:t.temp.instanceId,callback:function(e){t.$set(t.temp,"instanceId",e)},expression:"temp.instanceId"}},t._l(t.instancesListOptions,function(t,e){return s("el-option",{key:t+e,attrs:{label:t,value:t}})}),1)],1)],1):t._e()]),t._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v(t._s(t.$t("table.cancel")))]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleOptions()}}},[t._v(t._s(t.$t("table.confirm")))])],1)],1)],1)])},[],!1,null,null,null);y.options.__file="index.vue";e.default=y.exports}}]);