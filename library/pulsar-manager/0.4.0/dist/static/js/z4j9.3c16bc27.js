(window.webpackJsonp=window.webpackJsonp||[]).push([["z4j9"],{z4j9:function(t,e,s){"use strict";s.r(e);var i=s("P2sY"),o=s.n(i),r=s("EHAl"),a=s("F2Sz"),n=s("1tBZ"),p=s("HPFg"),c=s("7Qib"),l=s("iXUw"),u={persistent:"",tenant:"",namespace:"",topic:"",partition:"",subscription:""},m={cluster:""},h={name:"SubscriptionInfo",data:function(){return{postForm:o()({},u),clusterForm:o()({},m),subscriptionsListOptions:[],replicatedClusters:[],topActiveName:"consumers",leftActiveName:"",currentTopTabName:"consumers",currentLeftTabName:"skip",tenantsListOptions:[],namespacesListOptions:[],topicsListOptions:[],consumersListLoading:!1,consumerTableKey:0,consumersList:[],consumersTotal:0,consumersListQuery:{page:0,limit:1},inspectsList:[],inspectTableKey:0,inspectListLoading:!1,tabPosition:"left",form:{peekNumMessages:0,skipNumMessages:0,expireNumMessages:10,minutes:"0",messagesId:"",ledgerValue:""},firstInitNamespace:!1,firstInitTopic:!1,firstInitSubscription:!1,ledgerOptions:[],partitionsListOptions:[],topicPartitions:{},partitionDisabled:!1}},created:function(){if(this.postForm.persistent=this.$route.params&&this.$route.params.persistent,this.postForm.tenant=this.$route.params&&this.$route.params.tenant,this.postForm.namespace=this.$route.params&&this.$route.params.namespace,this.postForm.topic=this.$route.params&&this.$route.params.topic,this.postForm.topic.indexOf("-partition-")>0){var t=this.postForm.topic.split("-partition-");this.postForm.partition=t[1],this.postForm.topic=t[0]}else this.postForm.partition="-1",this.partitionDisabled=!0;this.tenantNamespaceTopic=this.postForm.tenant+"/"+this.postForm.namespace+"/"+this.postForm.topic,this.postForm.subscription=this.$route.params&&this.$route.params.subscription,this.firstInitNamespace=!0,this.firstInitTopic=!0,this.firstInitSubscription=!0,this.$route.query&&this.$route.query.topTab&&(this.topActiveName=this.$route.query.topTab,this.currentTopTabName=this.$route.query.topTab,this.$route.query.leftTab&&(this.leftActiveName=this.$route.query.leftTab)),this.getRemoteTenantsList(),this.getNamespacesList(this.postForm.tenant),this.getReplicatedClusters(),this.getTopicsList(),this.initTopicStats(),this.handleStatsInternal()},methods:{generatePartitions:function(){var t=parseInt(this.topicPartitions[this.postForm.topic]);if(this.partitionsListOptions=[],t>0){this.partitionDisabled=!1,"-1"===this.postForm.partition&&(this.postForm.partition="");for(var e=0;e<t;e++)this.partitionsListOptions.push(e);this.firstInitSubscription?this.getSubscriptionsList():(this.subscriptionsListOptions=[],this.postForm.subscription="")}else this.partitionDisabled=!0,this.postForm.partition="-1",this.partitionsListOptions.push("-1"),this.getSubscriptionsList()},getRemoteTenantsList:function(){var t=this;Object(r.b)().then(function(e){if(e.data)for(var s=0;s<e.data.total;s++)t.tenantsListOptions.push(e.data.data[s].tenant)})},getReplicatedClusters:function(){var t=this;this.postForm.tenant&&this.postForm.namespace&&Object(a.g)(this.postForm.tenant,this.postForm.namespace).then(function(e){e.data&&(t.replicatedClusters=e.data,e.data.length>0&&(t.clusterForm.cluster=t.routeCluster||t.replicatedClusters[0]))})},getCurrentCluster:function(){return this.clusterForm.cluster||""},getNamespacesList:function(t){var e=this,s=[];this.namespacesListOptions=[],this.topicsListOptions=[],this.partitionsListOptions=[],this.subscriptionsListOptions=[],this.firstInitNamespace?this.firstInitNamespace=!1:(this.postForm.namespace="",this.postForm.topic="",this.postForm.partition="",this.postForm.subscription=""),Object(a.f)(t,this.query).then(function(t){if(t.data)for(var i=0;i<t.data.data.length;i++)s=t.data.data[i].namespace,e.namespacesListOptions.push(s)})},getTopicsList:function(){var t=this;this.getReplicatedClusters(),this.topicsListOptions=[],this.partitionsListOptions=[],this.subscriptionsListOptions=[],this.firstInitTopic?this.firstInitTopic=!1:(this.postForm.topic="",this.postForm.partition="",this.postForm.subscription=""),Object(n.n)(this.postForm.tenant,this.postForm.namespace).then(function(e){if(e.data)for(var s in e.data.topics)t.topicsListOptions.push(e.data.topics[s].topic),t.topicPartitions[e.data.topics[s].topic]=e.data.topics[s].partitions,e.data.topics[s].topic===t.postForm.topic&&t.generatePartitions()})},getSubscriptionsList:function(){var t=this;Object(p.b)(this.postForm.persistent,this.getFullTopic()).then(function(e){if(e.data)for(var s in t.firstInitSubscription?t.firstInitSubscription=!1:(t.subscriptionsListOptions=[],t.postForm.subscription=""),e.data)t.subscriptionsListOptions.push(e.data[s])})},getSubscriptionsInfo:function(){this.$router.push({path:"/management/subscriptions/"+this.postForm.persistent+"/"+this.getFullTopic()+"/"+this.postForm.subscription+"/subscription?topTab="+this.currentTopTabName+"&leftTab="+this.currentLeftTabName})},handleStatsInternal:function(){var t=this;Object(n.l)(this.postForm.persistent,this.getFullTopic()).then(function(e){if(e.data)for(var s in e.data.ledgers)t.ledgerOptions.push({value:e.data.ledgers[s].ledgerId,label:e.data.ledgers[s].ledgerId})})},getFullTopic:function(){var t=this.postForm.tenant+"/"+this.postForm.namespace+"/"+this.postForm.topic;return parseInt(this.postForm.partition)>=0&&(t+="-partition-"+this.postForm.partition),t},initTopicStats:function(){var t=this;Object(n.k)(this.postForm.persistent,this.getFullTopic()).then(function(e){if(e.data&&e.data.subscriptions.hasOwnProperty(t.postForm.subscription)){var s=e.data.subscriptions[t.postForm.subscription];if(s.hasOwnProperty("consumers")){var i=s.consumers;for(var o in i)t.consumersList.push({consumerName:i[o].consumerName,outMsg:Object(l.numberFormatter)(i[o].msgRateOut,2),outBytes:Object(c.a)(i[o].msgThroughputOut),avgMsgSize:Object(c.a)(e.data.averageMsgSize),address:i[o].address,since:i[o].connectedSince})}}})},handleClick:function(t,e){this.currentTopTabName=t.name,"backlogOperation"===this.currentTopTabName?this.$router.push({query:{topTab:t.name,leftTab:this.currentLeftTabName}}):this.$router.push({query:{topTab:t.name}})},handleLeftTabClick:function(t,e){this.currentLeftTabName=t.name},getConsumers:function(){},handlePeekMessages:function(){var t=this;this.form.peekNumMessages<=0?this.$notify({title:"error",message:this.$i18n.t("topic.subscription.messageGreaterThanZero"),type:"error",duration:3e3}):Object(p.c)(this.getCurrentCluster(),this.postForm.persistent,this.tenantNamespaceTopic,this.postForm.subscription,this.form.peekNumMessages).then(function(e){if(e.data)if(e.data.hasOwnProperty("error"))t.$notify({title:"error",message:e.data.error,type:"error",duration:3e3});else if(e.data.data)if(e.data.data.hasOwnProperty("error"))t.$notify({title:"error",message:t.$i18n.t("topic.subscription.peekMessageError"),type:"error",duration:3e3});else{t.inspectsList=[];for(var s=0;s<e.data.data.length;s++)t.inspectsList.push({messageId:s,entryId:e.data.data[s].entryId,ledgerId:e.data.data[s].ledgerId,data:window.atob(e.data.data[s].data)})}})},handleSkipMessages:function(){var t=this;this.form.skipNumMessages<=0?this.$notify({title:"error",message:this.$i18n.t("topic.subscription.messageGreaterThanZero"),type:"error",duration:3e3}):Object(n.z)(this.getCurrentCluster(),this.postForm.persistent,this.getFullTopic(),this.postForm.subscription,this.form.skipNumMessages).then(function(e){t.$notify({title:"success",message:t.$i18n.t("topic.subscription.messageSkipSuccess"),type:"success",duration:3e3})})},handleExpireMessages:function(){var t=this;this.form.expireMessages<=0?this.$notify({title:"error",message:this.$i18n.t("topic.subscription.messageGreaterThanZero"),type:"error",duration:3e3}):Object(n.f)(this.getCurrentCluster(),this.postForm.persistent,this.getFullTopic(),this.postForm.subscription,this.form.expireNumMessages).then(function(e){t.$notify({title:"success",message:t.$i18n.t("topic.subscription.expireMessageSuccess"),type:"success",duration:3e3})})},handleClearBacklog:function(){var t=this;Object(n.a)(this.getCurrentCluster(),this.postForm.persistent,this.getFullTopic(),this.postForm.subscription).then(function(e){t.$notify({title:"success",message:t.$i18n.t("topic.subscription.clearMessageSuccess"),type:"success",duration:3e3})})},handleResetCursorByTime:function(){var t=this;if(parseInt(this.form.minutes)<=0)this.$notify({title:"error",message:this.$i18n.t("topic.subscription.minutesNotLessThanZero"),type:"error",duration:3e3});else{var e=(new Date).getTime(),s=Math.floor(e)-60*parseInt(this.form.minutes)*1e3;Object(n.x)(this.getCurrentCluster(),this.postForm.persistent,this.getFullTopic(),this.postForm.subscription,s).then(function(e){t.$notify({title:"success",message:t.$i18n.t("topic.subscription.resetCursorSuccess"),type:"success",duration:3e3})})}},handleResetCursorByMessageId:function(){var t=this;if(this.form.messagesId.length<=0&&null!=this.form.ledgerValue)this.$notify({title:"error",message:this.$i18n.t("topic.subscription.messageIdNotLessThanZero"),type:"error",duration:3e3});else{var e={ledgerId:this.form.ledgerValue,entryId:parseInt(this.form.messagesId)};Object(n.w)(this.getCurrentCluster(),this.postForm.persistent,this.getFullTopic(),this.postForm.subscription,e).then(function(e){t.$notify({title:"success",message:t.$i18n.t("topic.subscription.resetCursorSuccess"),type:"success",duration:3e3})})}},handleFilterConsumer:function(){}}},d=s("KHd+"),f=Object(d.a)(h,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"createPost-container"},[s("el-form",{staticClass:"form-container",attrs:{inline:!0,model:t.postForm}},[s("el-form-item",{attrs:{label:t.$t("tenant.label")}},[s("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"select tenant"},on:{change:function(e){return t.getNamespacesList(t.postForm.tenant)}},model:{value:t.postForm.tenant,callback:function(e){t.$set(t.postForm,"tenant",e)},expression:"postForm.tenant"}},t._l(t.tenantsListOptions,function(t,e){return s("el-option",{key:t+e,attrs:{label:t,value:t}})}),1)],1),t._v(" "),s("el-form-item",{attrs:{label:t.$t("namespace.label")}},[s("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"select namespace"},on:{change:function(e){return t.getTopicsList()}},model:{value:t.postForm.namespace,callback:function(e){t.$set(t.postForm,"namespace",e)},expression:"postForm.namespace"}},t._l(t.namespacesListOptions,function(t,e){return s("el-option",{key:t+e,attrs:{label:t,value:t}})}),1)],1),t._v(" "),s("el-form-item",{attrs:{label:t.$t("topic.label")}},[s("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"select topic"},on:{change:function(e){return t.generatePartitions()}},model:{value:t.postForm.topic,callback:function(e){t.$set(t.postForm,"topic",e)},expression:"postForm.topic"}},t._l(t.topicsListOptions,function(t,e){return s("el-option",{key:t+e,attrs:{label:t,value:t}})}),1)],1),t._v(" "),s("el-form-item",{attrs:{label:t.$t("topic.partition")}},[s("el-select",{staticStyle:{width:"150px"},attrs:{disabled:t.partitionDisabled,placeholder:"select partition"},on:{change:function(e){return t.getSubscriptionsList()}},model:{value:t.postForm.partition,callback:function(e){t.$set(t.postForm,"partition",e)},expression:"postForm.partition"}},t._l(t.partitionsListOptions,function(t,e){return s("el-option",{key:t+e,attrs:{label:t,value:t}})}),1)],1),t._v(" "),s("el-form-item",{attrs:{label:t.$t("topic.subscription.label")}},[s("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"select subscription"},on:{change:function(e){return t.getSubscriptionsInfo()}},model:{value:t.postForm.subscription,callback:function(e){t.$set(t.postForm,"subscription",e)},expression:"postForm.subscription"}},t._l(t.subscriptionsListOptions,function(t,e){return s("el-option",{key:t+e,attrs:{label:t,value:t}})}),1)],1)],1),t._v(" "),t.replicatedClusters.length>0?s("el-form",{staticClass:"form-container",attrs:{inline:!0,model:t.clusterForm}},[s("el-form-item",{attrs:{label:t.$t("table.cluster")}},[s("el-radio-group",{on:{change:function(e){return t.onClusterChanged()}},model:{value:t.clusterForm.cluster,callback:function(e){t.$set(t.clusterForm,"cluster",e)},expression:"clusterForm.cluster"}},t._l(t.replicatedClusters,function(t){return s("el-radio-button",{key:t,attrs:{label:t}})}),1)],1)],1):t._e()],1),t._v(" "),s("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.topActiveName,callback:function(e){t.topActiveName=e},expression:"topActiveName"}},[s("el-tab-pane",{attrs:{label:t.$t("topic.consumer.consumers"),name:"consumers"}},[s("el-row",{attrs:{gutter:24}},[s("el-col",{attrs:{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:24},xl:{span:24}}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.consumersListLoading,expression:"consumersListLoading"}],key:t.consumerTableKey,staticStyle:{width:"100%"},attrs:{data:t.consumersList,border:"",fit:"","highlight-current-row":""}},[s("el-table-column",{attrs:{label:t.$t("topic.consumer.name"),"min-width":"30px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.consumerName))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("common.outMsg"),"min-width":"30px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.outMsg))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("common.outBytes"),"min-width":"30px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.outBytes))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("topic.consumer.avgMsgSize"),"min-width":"30px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.avgMsgSize))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("topic.consumer.address"),"min-width":"30px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.address))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("topic.consumer.since"),"min-width":"30px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.since))])]}}])})],1)],1)],1)],1),t._v(" "),s("el-tab-pane",{attrs:{label:t.$t("topic.backlogOpeartion"),name:"backlogOperation"}},[s("el-tabs",{attrs:{"tab-position":t.tabPosition},on:{"tab-click":t.handleLeftTabClick},model:{value:t.leftActiveName,callback:function(e){t.leftActiveName=e},expression:"leftActiveName"}},[s("el-tab-pane",{attrs:{label:t.$t("topic.subscription.skip"),name:"skip"}},[s("el-form",{attrs:{inline:!0,model:t.form}},[s("el-button",{attrs:{type:"primary"},on:{click:t.handleSkipMessages}},[t._v(t._s(t.$t("topic.subscription.skip")))]),t._v(" "),s("el-form-item",[s("el-input",{attrs:{placeholder:"messages"},model:{value:t.form.skipNumMessages,callback:function(e){t.$set(t.form,"skipNumMessages",e)},expression:"form.skipNumMessages"}})],1),t._v(" "),s("span",[t._v(t._s(t.$t("topic.subscription.skipMessage")))])],1)],1),t._v(" "),s("el-tab-pane",{attrs:{label:t.$t("topic.subscription.expire"),name:"expire"}},[s("el-form",{attrs:{inline:!0,model:t.form}},[s("el-button",{attrs:{type:"primary"},on:{click:t.handleExpireMessages}},[t._v(t._s(t.$t("topic.subscription.expire")))]),t._v(" "),s("el-form-item",[s("el-input",{attrs:{placeholder:"messages"},model:{value:t.form.expireNumMessages,callback:function(e){t.$set(t.form,"expireNumMessages",e)},expression:"form.expireNumMessages"}})],1),t._v(" "),s("span",[t._v(t._s(t.$t("topic.subscription.expireMessage")))])],1)],1),t._v(" "),s("el-tab-pane",{attrs:{label:t.$t("topic.subscription.clear"),name:"clear"}},[s("el-form",{attrs:{inline:!0,model:t.form}},[s("el-button",{attrs:{type:"primary"},on:{click:t.handleClearBacklog}},[t._v(t._s(t.$t("topic.subscription.clear")))]),t._v(" "),s("span",[t._v(t._s(t.$t("topic.subscription.clearMessage")))])],1)],1),t._v(" "),s("el-tab-pane",{attrs:{label:t.$t("topic.subscription.reset"),name:"reset"}},[s("el-form",{attrs:{inline:!0,model:t.form}},[s("el-button",{attrs:{type:"primary"},on:{click:t.handleResetCursorByTime}},[t._v(t._s(t.$t("topic.subscription.resetByTimeMessage")))]),t._v(" "),s("span",[t._v("The cursor to")]),t._v(" "),s("el-form-item",[s("el-input",{attrs:{placeholder:"minutes"},model:{value:t.form.minutes,callback:function(e){t.$set(t.form,"minutes",e)},expression:"form.minutes"}})],1),t._v(" "),s("span",[t._v(t._s(t.$t("topic.subscription.mins")))]),t._v(" "),s("br"),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.handleResetCursorByMessageId}},[t._v(t._s(t.$t("topic.subscription.resetById")))]),t._v(" "),s("span",[t._v(t._s(t.$t("topic.subscription.messageId")))]),t._v(" "),s("el-form-item",[s("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:t.$t("topic.segment.ledgerId")},model:{value:t.form.ledgerValue,callback:function(e){t.$set(t.form,"ledgerValue",e)},expression:"form.ledgerValue"}},t._l(t.ledgerOptions,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),t._v(" "),s("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:t.$t("topic.subscription.messageId")},model:{value:t.form.messagesId,callback:function(e){t.$set(t.form,"messagesId",e)},expression:"form.messagesId"}})],1)],1)],1),t._v(" "),s("el-tab-pane",{attrs:{label:"INSPECT",name:"peek"}},[s("el-form",{attrs:{inline:!0,model:t.form}},[s("el-button",{attrs:{type:"primary"},on:{click:t.handlePeekMessages}},[t._v(t._s(t.$t("topic.subscription.peek")))]),t._v(" "),s("el-form-item",[s("el-input",{attrs:{placeholder:"messages"},model:{value:t.form.peekNumMessages,callback:function(e){t.$set(t.form,"peekNumMessages",e)},expression:"form.peekNumMessages"}})],1),t._v(" "),s("span",[t._v(t._s(t.$t("topic.subscription.peekMessages")))])],1),t._v(" "),s("el-row",{staticStyle:{"margin-top":"15px"},attrs:{gutter:24}},[s("el-col",{staticStyle:{"padding-right":"20px","margin-bottom":"30px"},attrs:{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:24},xl:{span:24}}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.inspectListLoading,expression:"inspectListLoading"}],key:t.inspectTableKey,staticStyle:{width:"100%"},attrs:{data:t.inspectsList,border:"",fit:"","highlight-current-row":""}},[s("el-table-column",{attrs:{label:t.$t("topic.segment.ledgerId"),"min-width":"10px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.ledgerId))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("topic.subscription.entryId"),"min-width":"10px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.entryId))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("topic.subscription.message"),"min-width":"30px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.data))])]}}])})],1)],1)],1)],1)],1)],1)],1)],1)},[],!1,null,null,null);f.options.__file="subscription.vue";e.default=f.exports}}]);