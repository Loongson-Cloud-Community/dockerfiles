# This file is generated by the template.

REGISTRY?=cr.loongnix.cn
ORGANIZATION?=kubernetes-ingress-controller
REPOSITORY?=nginx-ingress-controller
TAG?=0.9.0

INGRESS_URL=https://github.com/Loongson-Cloud-Community/kubernetes_ingress-nginx/releases/download/0.9.0/nginx-ingress-controller-loong64
DUMB_URL=https://github.com/Loongson-Cloud-Community/Yelp_dumb-init/releases/download/v1.2.0/dumb-init-loong64
PROXY=

IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):$(TAG)


default: image

download:
	@echo "downloading"
	https_proxy=$(PROXY) wget $(INGRESS_URL) -O rootfs/nginx-ingress-controller && chmod +x rootfs/nginx-ingress-controller
	https_proxy=$(PROXY) wget $(DUMB_URL) -O rootfs/dumb-init

image: download
	docker build \
		-t $(IMAGE) \
		rootfs
clear:
	rm -f rootfs/nginx-ingress-controller rootfs/dumb-init  

push: clear
	docker push $(IMAGE)

test:
	docker run --rm cr.loongnix.cn/kubernetes-ingress-controller/nginx-ingress-controller:0.9.0 /nginx-ingress-controller -h  
