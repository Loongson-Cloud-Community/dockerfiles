# This file is generated by the template.

REGISTRY?=cr.loongnix.cn
ORGANIZATION?=calico
REPOSITORY?=go-build
TAG?=0.73

SOURCE=https://github.com/projectcalico/go-build.git
PATCH=0001-port-to-loongarch64.patch

IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):$(TAG)

default: image

image: src/$(REPOSITORY)
	$(MAKE) -C src/$(REPOSITORY) image ARCHIMAGE=$(IMAGE)

src/$(REPOSITORY):
	mkdir -p src
	git clone -b v$(TAG) --depth=1 $(SOURCE) $@
	cd $@ && \
		git apply ../../$(PATCH)

push:
	docker push $(IMAGE)

clean:
	rm -rf src
