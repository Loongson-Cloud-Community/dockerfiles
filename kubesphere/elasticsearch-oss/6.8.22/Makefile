# This file is generated by the template.

REGISTRY?=cr.loongnix.cn
ORGANIZATION?=kubesphere
REPOSITORY?=elasticsearch-oss
TAG?=6.8.22

IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):$(TAG)

URL?=https://github.com/Loongson-Cloud-Community/elasticsearch/releases/download/v6.8.22/elasticsearch-oss-6.8.22-linux-loongarch64.tar.gz

TAR_GZ?=elasticsearch-oss-6.8.22.tar.gz

default: image

check:
	@[ -f Dockerfile ] || (echo "error: Dockerfile has lost." ; exit 1) 
	@[ -d bin ] || (echo "error: bin directory has lost." ; exit 1)
	@[ -d elasticsearch ] || (echo "elasticsearch is needed,downloading..." ;\
	       	wget -O $(TAR_GZ) -q $(URL)&& \
		tar -zxf $(TAR_GZ) && \
		rm -f $(TAR_GZ) && \
		echo "done.")	

image: check
	sudo docker build \
		-t $(IMAGE) \
		.

push:
	docker push $(IMAGE)

clean:
	@rm -rf elastic*
